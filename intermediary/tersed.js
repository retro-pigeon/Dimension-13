zzfx=(...a)=>zzfxP(zzfxG(...a));zzfxP=(...a)=>{let b=zzfxX.createBufferSource(),c=zzfxX.createBuffer(a.length,a[0].length,zzfxR);a.map((e,d)=>c.getChannelData(d).set(e));b.buffer=c;b.connect(zzfxX.destination);b.start();return b};
zzfxG=(a=1,b=.05,c=220,e=0,d=0,k=.1,h=0,q=1,p=0,t=0,y=0,H=0,P=0,Ga=0,wa=0,gb=0,D=0,xa=1,U=0,Ha=0)=>{let C=2*Math.PI,hb=p*=500*C/zzfxR**2,ib=(0<wa?1:-1)*C/4;b=c*=(1+2*b*Math.random()-b)*C/zzfxR;let ya=[],I=0,Ia=0,v=0,V=1,jb=0,kb=0,E=0,W,Q;e=99+zzfxR*e;U*=zzfxR;d*=zzfxR;k*=zzfxR;D*=zzfxR;t*=500*C/zzfxR**3;wa*=C/zzfxR;y*=C/zzfxR;H*=zzfxR;P=zzfxR*P|0;for(Q=e+U+d+k+D|0;v<Q;ya[v++]=E)++kb%(100*gb|0)||(E=h?1<h?2<h?3<h?Math.sin((I%C)**3):Math.max(Math.min(Math.tan(I),1),-1):1-(2*I/C%2+2)%2:1-4*Math.abs(Math.round(I/
C)-I/C):Math.sin(I),E=(P?1-Ha+Ha*Math.sin(2*Math.PI*v/P):1)*(0<E?1:-1)*Math.abs(E)**q*a*zzfxV*(v<e?v/e:v<e+U?1-(v-e)/U*(1-xa):v<e+U+d?xa:v<Q-D?(Q-v-D)/k*xa:0),E=D?E/2+(D>v?0:(v<Q-D?1:(Q-v)/D)*ya[v-D|0]/2):E),W=(c+=p+=t)*Math.sin(Ia*wa-ib),I+=W-W*Ga*(1-1E9*(Math.sin(v)+1)%2),Ia+=W-W*Ga*(1-1E9*(Math.sin(v)**2+1)%2),V&&++V>H&&(c+=y,b+=y,V=0),!P||++jb%P||(c=b,p=hb,V=V||1);return ya};zzfxV=.5;zzfxR=44100;zzfxX=new (window.AudioContext||webkitAudioContext);
var aa=[0,0,-150,-86,0,-75,-86,0,75,0,0,150,86,0,75,86,0,-75,0,50,-96,-55,50,-48,-55,50,48,0,50,96,55,50,48,55,50,-48,0,-50,-96,-55,-50,-48,-55,-50,48,0,-50,96,55,-50,48,55,-50,-48],ba=[4,9,3,2,7,1,5,10,4,3,8,2,1,6,0,0,11,5,8,10,6,15,4,3,1,14,2,4,17,5,2,15,3,12,1,0,5,12,0,12,16,14,4,10,9,2,8,7,5,11,10,3,9,8,1,7,6,0,6,11,6,7,8,8,9,10,10,11,6,15,16,4,1,13,14,4,16,17,2,14,15,12,13,1,5,17,12,14,13,12,12,17,16,16,15,14],ca=[["#80D08C",32]],da=[-91,208,125,-91,338,-4,-91,78,-4,-206,208,-257,0,208,154,0,
367,-4,-112,288,75,-112,129,75,-124,295,-67,-124,120,-67,0,50,-4,-202,212,-397,0,318,104,-154,208,-4,0,87,-100,0,99,104,0,328,-100,-107,296,-582,-88,220,-631,-107,144,-582,0,220,-658,0,115,-611,0,325,-611,-150,345,-261,0,395,-312,0,28,-312,-188,78,-261],ea=[12,1,6,12,0,4,0,13,7,1,13,6,8,9,13,13,2,7,2,14,10,11,17,18,0,15,4,2,15,7,24,17,23,1,16,8,18,21,19,18,22,20,11,19,26,25,19,21,14,26,25,3,26,9,16,23,8,3,23,11,12,5,1,12,6,0,0,6,13,1,8,13,8,3,9,13,9,2,2,9,14,11,23,17,0,7,15,2,10,15,24,22,17,1,5,16,
18,20,21,18,17,22,11,18,19,25,26,19,14,9,26,3,11,26,16,24,23,3,8,23],fa=[["#442424",40]],ha=[-328,194,-200,-326,234,-200,-324,194,-160,-322,234,-160,-167,165,-168,-161,223,-168,-172,165,-221,-166,223,-222,-442,195,-185,-450,227,-184,-439,195,-153,-446,227,-152,-569,143,-170,-589,161,-168,-567,143,-144,-586,161,-142,-627,0,-158,-640,5,-157,-625,0,-144,-639,5,-143],ia=[5,2,4,3,10,2,2,6,4,5,1,3,0,7,6,11,14,10,1,8,9,2,8,0,1,11,3,13,19,15,9,12,13,10,12,8,9,15,11,14,19,18,12,17,13,14,16,12,5,3,2,3,11,10,
2,0,6,5,7,1,0,1,7,11,15,14,1,0,8,2,10,8,1,9,11,13,17,19,9,8,12,10,14,12,9,13,15,14,15,19,12,16,17,14,18,16],ja=[["#5d5775",32]],ka=[0,-26,-200,84,-26,-97,226,-26,0,84,-26,97,0,-26,200,-84,-26,97,-173,-26,0,-84,-26,-97,0,1015,0],la=[0,8,1,1,8,2,2,8,3,3,8,4,4,8,5,5,8,6,6,8,7,7,8,0],ma=[["#247BA0",8]],na=[-100,0,100,100,0,100,-100,0,-100,100,0,-100],oa=[1,2,0,1,3,2],pa=[["#70C1B3",2]],qa=[-70,0,70,-100,0,0,-100,23,0,-70,23,70,0,0,0,0,23,0,-35,0,35,-50,0,0,-50,23,0,-35,23,35,-82,0,82,-116,0,0,-116,13,
0,-82,13,82],ra=[5,3,9,3,4,5,3,6,0,5,1,2,8,6,9,1,8,2,2,9,3,1,12,11,0,13,3,3,12,2,13,11,12,8,2,5,9,8,5,3,0,4,3,9,6,5,4,1,8,7,6,1,7,8,2,8,9,1,2,12,0,10,13,3,13,12,13,10,11],sa=[["#778899",23]],ta=[0,0,-100,-86,0,50,86,0,50,0,0,100,86,0,-50,-86,0,-50],ua=[4,5,3,1,2,0],va=[["#FFFFFF",2]],za=[0,0,-100,-28,0,-95,-54,0,-84,-75,0,-65,-90,0,-41,-98,0,-14,-98,0,14,-90,0,41,-75,0,65,-54,0,84,-28,0,95,0,0,99,28,0,95,54,0,84,75,0,65,90,0,41,98,0,14,98,0,-14,90,0,-41,75,0,-65,54,0,-84,28,0,-95],Aa=[2,21,0,0,1,
2,2,20,21,5,18,3,3,4,5,5,17,18,18,19,3,8,15,6,6,7,8,8,14,15,15,16,6,11,13,9,9,10,11,11,12,13],Ba=[["#E87C00",3],["#E85F5A",4],["#E81F67",4],["#E700B5",3]],Ca=[-92,-2,-38,12,197,99,-83,2,-55,-6,202,99,-21,164,97,-53,131,84,-79,97,60,-95,64,29,-99,31,-4,-40,168,91,-68,135,72,-89,102,44,-99,68,11,-97,35,-23],Da=[0,13,2,7,11,12,5,9,10,0,8,13,7,6,11,5,4,9,4,3,9,8,12,13,6,10,11,4,1,3,8,7,12,6,5,10],Ea=[["#73E1E733",6],["#50BEEF22",6]],Fa=[0,1950,0,-578,2156,0,-408,2156,408,0,2156,0,-460,1806,460,-650,1806,
0,0,1806,0,-358,2446,367,-506,2480,0,0,2337,0,-151,2718,0,-107,2685,132,0,2608,0,0,2718,0,-1237,1973,0,-1236,1930,0,-1240,1950,0,-874,1930,874,-875,1973,875,-877,1950,877,-1374,0,0,-971,0,971],Ja=[3,7,9,1,9,8,1,7,2,9,11,12,9,10,8,8,11,7,10,12,13,12,11,13,11,10,13,5,4,6,4,20,5,3,2,7,1,3,9,1,8,7,9,7,11,9,12,10,8,10,11,4,21,20,16,3,1,19,6,4,19,2,3,16,5,6,15,4,5,14,15,16,17,18,19,15,18,17,18,1,2,1,14,16,16,0,3,4,17,19,19,0,6,3,0,19,19,18,2,6,0,16,16,15,5,15,17,4,15,14,18,18,14,1],Ka=[["#10E70022",18],
["#6FB2BE",20]],La=[-70,0,70,0,0,100,0,0,0,-56,-16,56,0,-16,80,0,-16,44,-31,-16,31,0,-9,44,-31,-9,31,0,-9,0],Ma=[7,9,8,4,6,3,0,4,3,5,8,6,4,5,6,0,1,4,5,7,8],Na=[["#E7000E",1],["#E7B500",6]],Oa=[0,-70,-100,86,-70,50,-86,-70,50,0,70,0],Pa=[0,3,1,0,1,2,1,3,2,2,3,0];
const Qa=()=>{let a=50-100*Math.random(),b=50-100*Math.random();if(!f(a,b)&&10<Math.hypot(a,b))return Qa();const c=g(aa,ba,ca,l(a,0,b),l(Math.PI/2,0,0),l(.25,.25,.25));m.push(c);const e=g(ta,ua,va,l(a,30,b),l(Math.PI/2,0,0),l(2,2,2));m.push(e);return d=>{c.position.y=.25*Math.sin(timeStamp/1E3)+1;c.rotation.y+=d;e.rotation.y+=d*Math.random();c.l||Math.random()<d&&Ra(Sa(c.position),l(rand(.005),rand(.025),rand(.005)),"#80D08C");if(!c.l&&3>distanceTo(c.position,n.position)&&(c.l=!0,r++,zzfx(...[,,539,
0,.04,.29,1,1.92,,,567,.02,.02,,,,.04]),4==r&&(say("Is it a bird? Is it a plane? It's a UFO",1.2),u.push(Ta()),u.push(Ta()),u.push(Ta())),2==r))for(say("By the way, watch out for the Arachnoids",1.2),"",d=0;50>d;d++){let k=50-100*Math.random(),h=50-100*Math.random();f(k,h)&&10<distanceTo(l(w,w,w),l(k,0,h))&&Ua.push(Va(l(k,0,h)))}}},Wa=a=>{const b=g(La,Ma,Na,a,w,l(1,-1,1),1,1);m.push(b);console.log(`Landmine: ${a.x} ${a.y} ${a.z}`);return()=>{2.5>distanceTo(n.position,b.position)&&(console.log("stepped on landmine"),
zzfx(...[2,,45,.01,.27,.49,3,1.6,-9,,,,,1.3,.4,.8,.2,.41,.15]),x=-.1)}};let Xa=[];var f=(a,b)=>{for(const c of Xa){let e=0;for(let d=0;d<c.length;d+=4){let k=c[d],h=c[d+1],q=c[d+2],p=c[d+3];b<h!==b<p&&a<k+(b-h)/(p-h)*(q-k)&&(e+=1)}if(0!==e%2)return!0}return!1};
function Ya(){function a(d,k){return 0<=d&&0<=k&&50>d&&50>k}function b(d,k){c[k][d]=0;e.sort(()=>Math.random()-.5).forEach(([h,q])=>{const [p,t]=[d+h,k+q],[y,H]=[d+h/2,k+q/2];a(p,t)&&c[t][p]&&(c[H][y]=0,b(p,t))})}const c=Array.from({length:50},()=>Array(50).fill(1)),e=[[0,2],[2,0],[0,-2],[-2,0]];b(1,1);for(let d=-2;2>=d;d++)for(let k=-2;2>=k;k++)a(25+k,25+d)&&(c[25+d][25+k]=0);c[0][1]=c[49][48]=0;return c}
const Za=()=>{var a=z([]),b=Ya().flat().map(c=>.2>Math.random()?0:c);for(let c=0;2500>c;c++){const e=c%50*4-100+3,d=4*Math.floor(c/50)-100+3;if(b[c])a.g.push(g(ka,la,ma,l(e,0,d),l(.2-.4*Math.random(),Math.random()*Math.PI*2,0),l(1,1,1)));else{let k=.2*b[c-50],h=-.2*b[c+50],q=.2*b[c-1],p=-.2*b[c+1];Xa.push([e-2+q,d-2+k,e-2+q,d+2+h,e-2+q,d+2+h,e+2+p,d+2+h,e+2+p,d+2+h,e+2+p,d-2+k,e+2+p,d-2+k,e-2+q,d-2+k])}}m.push(a)};messages=[];
showMessage=(a,b,c,e=50,d=1E6,k=0)=>messages.push({text:a,x:b,y:c,size:e,duration:d,delay:k,counter:0,S:Math.max(random(3),1)});
updateMessages=()=>{messages.forEach((a,b)=>{0<a.delay--||(a.counter+=1,A.font=`${a.size}px ${"serif"}`,A.textAlign="center",A.textBaseline="middle",100>a.duration&&(a.y-=a.S),20>=a.counter&&(A.fillStyle=`rgba(255,255,255 ,${a.counter/20})`),20<a.counter&&a.counter<=a.duration-60&&(A.fillStyle="white"),a.counter>a.duration-60&&(A.fillStyle=`rgba(255,255,255,${-(a.counter-a.duration)/60})`),A.fillText(a.text,a.x,a.y),a.counter>a.duration&&messages.splice(b,1))})};
let $a=[],bb=()=>{let a=l(Math.cos(timeStamp/1E3)/10+.025-Math.random()/20,0,Math.sin(timeStamp/1E3)/10+.025-Math.random()/20),b=[];$a.forEach((c,e)=>{c.h.position=B(c.h.position,c.s);c.h.position=B(c.h.position,multiplyBy(a,F));c.h.rotation=B(c.h.rotation,c.N);c.counter-=F/20;c.h.opacity=Math.max(c.counter/c.K,0);0>=c.counter?(c.h.l=!0,b.push(e)):c.I&&(c.s.y-=.02*F)});b.reverse().forEach(c=>{ab.g.splice(c,1);$a.splice(c,1)})};
const Ra=(a,b,c="#FFFFFF",e=l(.005-.01*Math.random(),.05-.01*Math.random(),.005-.01*Math.random()),d=1,k=!1)=>{a=g(Oa,Pa,[[c,4]],a,w,l(.1,.1,.1));ab.g.push(a);$a.push({h:a,s:b,counter:d,N:e,K:d,I:k})};var G=[],J=[],cb=[],K=0;
const Va=a=>{let b=Ua.length,c=0,e=3;G.push(a);J.push(1+Math.random()/2);cb.push(1);let d=z([g(da,ea,fa,l(0,0,.8),w,l(.25,.25,.25),1),g(ha,ia,ja,l(0,0,0),w,l(.25,.25,.25),1),g(ha,ia,ja,l(0,0,.4),w,l(.25,.25,.25),1),g(ha,ia,ja,l(0,0,.8),w,l(.25,.25,.25),1),g(ha,ia,ja,l(0,0,1.2),w,l(.25,.25,.25),1)]);d.scale=l(J[b],J[b],J[b]);d.position=a;m.push(d);return k=>{if(0>=J[b])d.l=!0,cb[b]=0;else if(e-=k,c+=k,d.g[1].rotation=l(0,.05*Math.cos(c),.15*Math.sin(c)),d.g[2].rotation=l(0,.05*Math.sin(c),.15*Math.cos(c)),
d.g[3].rotation=l(0,.05*Math.cos(c),.15*Math.sin(c)),d.g[4].rotation=l(0,.05*Math.sin(c),.15*Math.cos(c)),d.rotation.y=Math.atan2(n.position.x-d.position.x,n.position.z-d.position.z),!(4.358>=distanceTo(l(w,w,w),n.position))){if(3<distanceTo(d.position,n.position)&&5<distanceTo(l(w,w,w),d.position)){var h=Sa(d.position);h.x+=Math.sin(d.rotation.y)*k;h.z+=Math.cos(d.rotation.y)*k;f(h.x,h.z)&&5<distanceTo(l(w,w,w),d.position)&&(d.position=h)}.1<K&&(h=Sa(d.position),h.x-=Math.sin(d.rotation.y)*k*K*5,
h.z-=Math.cos(d.rotation.y)*k*K*5,f(h.x,h.z)&&5<distanceTo(l(w,w,w),d.position)&&(d.position=h),K-=k/10);4>distanceTo(d.position,n.position)&&0>=e&&(x-=.05,e=3,zzfx(...[,,100,,.04,,4,5,,,,,,1.4,,.1,,.89,,,-2247]),db());G[b]=d.position}}},Ta=()=>{const a=g(Fa,Ja,Ka,void 0,void 0,l(.56,.56,.56),1,1);a.position=l(100-200*Math.random(),void 0,100-200*Math.random());m.push(a);let b=l(100-200*Math.random(),void 0,100-200*Math.random());return c=>{var e=substract(b,a.position);1>length(e)?b=l(100-200*Math.random(),
void 0,100-200*Math.random()):(e=normalize(e),e=multiplyBy(e,1*c),a.position=B(a.position,e));6>distanceTo(n.position,a.position)&&(x-=1*c)}};function db(){const a=navigator.getGamepads()[0];a?a.R?a.R.U("dual-rumble",{V:0,duration:1,Y:0,W:.1}).catch(b=>console.log("Vibration error:",b)):console.log("Vibration actuator not available on this gamepad."):console.log("Gamepad with index 0 not found.")}
const eb=(a,b,c,e=0,d=0)=>{var k=b.length,h=[],q=[];for(var p of b)h.push(a[3*p],a[3*p+1],a[3*p+2]);for(p=0;p<c.length;p+=4)q.push(c[p],c[p+1],c[p+2],c[p+3],c[p],c[p+1],c[p+2],c[p+3],c[p],c[p+1],c[p+2],c[p+3]);e&&(h=[...h,...h.map((t,y)=>y%3?t:-t)],q=[...q,...q],k*=2);d&&(h=[...h,...h.map((t,y)=>2==y%3?-t:t)],h=[...h,...h.map((t,y,H)=>1==y%3?t:2==y%3?H[y-2]:H[y+2])],q=[...q,...q,...q,...q],k*=4);e=CreateAndBindBufferData(h);q=CreateAndBindBufferData(q);h=CreateAndBindBufferData(getNormals(h));L.bindBuffer(L.ARRAY_BUFFER,
null);return{X:a,indices:b,T:c,J:k,P:e,G:q,M:h}};getNormals=a=>{let b=[];for(let c=0;c<a.length;c+=9){let e=cross(normalize(l(a[c+3]-a[c],a[c+3+1]-a[c+1],a[c+3+2]-a[c+2])),normalize(l(a[c+6]-a[c],a[c+6+1]-a[c+1],a[c+6+2]-a[c+2])));b.push(e.x,e.y,e.z,e.x,e.y,e.z,e.x,e.y,e.z)}return b};CreateAndBindBufferData=a=>{const b=L.createBuffer();L.bindBuffer(L.ARRAY_BUFFER,b);L.bufferData(L.ARRAY_BUFFER,new Float32Array(a),L.STATIC_DRAW);return b};
const z=a=>({L:!0,position:l(0,0,0),rotation:l(0,0,0),scale:l(1,1,1),g:a}),l=(a=0,b=0,c=0)=>({x:a,y:b,z:c}),Sa=a=>l(a.x,a.y,a.z),B=(a,b)=>l(a.x+b.x,a.y+b.y,a.z+b.z);substract=(a,b)=>l(a.x-b.x,a.y-b.y,a.z-b.z);multiplyBy=(a,b)=>l(a.x*b,a.y*b,a.z*b);divide=(a,b)=>l(a.x/b,a.y/b,a.z/b);length=a=>Math.hypot(a.x,a.y,a.z);cross=(a,b)=>l(a.y*b.z-a.z*b.y,a.z*b.x-a.x*b.z,a.x*b.y-a.y*b.x);dot=(a,b)=>a.x*b.x+a.y*b.y+a.z*b.z;normalize=a=>divide(a,length(a));
rotX=(a,b)=>l(a.x,a.y*Math.cos(b)-a.z*Math.sin(b),a.y*Math.sin(b)+a.z*Math.cos(b));rotY=(a,b)=>l(a.x*Math.cos(b)-a.z*Math.sin(b),a.y,a.x*Math.sin(b)+a.z*Math.cos(b));rotZ=(a,b)=>l(a.x*Math.cos(b)-a.y*Math.sin(b),a.x*Math.sin(b)+a.y*Math.cos(b),a.z);distanceTo=(a,b)=>length(substract(a,b));translate=a=>new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,a.x,a.y,a.z,1]);scale=a=>new Float32Array([a.x,0,0,0,0,a.y,0,0,0,0,a.z,0,0,0,0,1]);
rotateX=a=>{const b=Math.sin(a);a=Math.cos(a);return new Float32Array([1,0,0,0,0,a,b,0,0,-b,a,0,0,0,0,1])};rotateY=a=>{const b=Math.sin(a);a=Math.cos(a);return new Float32Array([a,0,-b,0,0,1,0,0,b,0,a,0,0,0,0,1])};rotateZ=a=>{const b=Math.sin(a);a=Math.cos(a);return new Float32Array([a,b,0,0,-b,a,0,0,0,0,1,0,0,0,0,1])};perspective=(a,b,c,e)=>{a=1/Math.tan(a/2);const d=1/(c-e);return new Float32Array([a/b,0,0,0,0,a,0,0,0,0,(e+c)*d,-1,0,0,2*e*c*d,0])};
lookAt=(a,b,c)=>{b=normalize(substract(a,b));c=normalize(cross(c,b));const e=cross(b,c);return new Float32Array([c.x,e.x,b.x,0,c.y,e.y,b.y,0,c.z,e.z,b.z,0,-dot(c,a),-dot(e,a),-dot(b,a),1])};multiply=(a,b)=>{const c=new Float32Array(16);for(let e=0;4>e;e++)for(let d=0;4>d;d++){let k=0;for(let h=0;4>h;h++)k+=a[4*e+h]*b[4*h+d];c[4*e+d]=k}return c};transform=(a,b,c)=>multiply(multiply(scale(c),multiply(multiply(rotateX(b.x),rotateY(b.y)),rotateZ(b.z))),translate(a));lerp=(a,b,c)=>a+(b-a)*c;
random=(a=1)=>Math.random()*a;randomBetween=a=>a-Math.random()*a*2;lerpColors=(a,b,c)=>Color(a.r+(b.r-a.r)*c,a.D+(b.D-a.D)*c,a.b+(b.b-a.b)*c);easeInOutCubic=a=>.5>a?4*a*a*a:1-Math.pow(-2*a+2,3)/2;angleBetween=(a,b)=>Math.atan2(a.x-b.x,a.z-b.z);abs=Math.abs;rand=a=>a-2*a*Math.random();
const g=(a,b,c,e=l(),d=l(),k=l(1,1,1),h=0,q=0)=>{let p=[];for(let t of c)for(c=0;c<t[1];c++)p.push(...fb(t[0]));return{m:eb(a.map(t=>t/100),b,p,h,q),position:e,rotation:d,scale:k}},fb=a=>[parseInt(a.slice(1,3),16)/255,parseInt(a.slice(3,5),16)/255,parseInt(a.slice(5,7),16)/255,parseInt(a.slice(7,9),16)/255||1];var lb=15;
const ob=(a,b,c=1,e=null)=>{c&&(L.clear(L.COLOR_BUFFER_BIT|L.DEPTH_BUFFER_BIT),L.uniform1f(mb,lb),L.viewport(0,0,L.canvas.width,L.canvas.height),L.uniformMatrix4fv(nb,!1,lookAt(b.position,b.target,b.O)));for(const d of a)d.l||(d.L?ob(d.g,b,0,transform(d.position,d.rotation,d.scale)):(L.uniform1f(uOpacityLocation,d.opacity||1),bindBufferAttribute(d.m.P,M.A),bindBufferAttribute(d.m.G,M.v,4),bindBufferAttribute(d.m.M,M.u),e?L.uniformMatrix4fv(pb,!1,multiply(transform(d.position,d.rotation,d.scale),e)):
L.uniformMatrix4fv(pb,!1,transform(d.position,d.rotation,d.scale)),L.drawArrays(L.TRIANGLES,0,d.m.J),L.bindBuffer(L.ARRAY_BUFFER,null)))};bindBufferAttribute=(a,b,c=3)=>{L.bindBuffer(L.ARRAY_BUFFER,a);L.vertexAttribPointer(b,c,L.FLOAT,!1,0,0);L.enableVertexAttribArray(b)};var mb;
const rb=()=>{L.clearColor(.2,.094,.196,1);L.enable(L.DEPTH_TEST);L.clearDepth(1);L.depthFunc(L.LEQUAL);L.enable(L.BLEND);L.blendFunc(L.SRC_ALPHA,L.ONE_MINUS_SRC_ALPHA);L.disable(L.CULL_FACE);M=L.createProgram();compileShader("#version 300 es\nprecision mediump float;uniform mat4 uMeshMatrix,uCameraMatrix,uProjectionMatrix;in vec3 B,D;in vec4 C;out vec4 A,E,Z;out vec3 F;void main(){gl_Position=uProjectionMatrix*uCameraMatrix*uMeshMatrix*vec4(B,1);E=C;A=gl_Position;Z=uMeshMatrix*vec4(B,1.0);}",L.VERTEX_SHADER,
M);compileShader("#version 300 es\nprecision mediump float;in vec4 A;in vec3 F;in vec4 Z,E;uniform float G,O;out vec4 fragColor;void main(){float P=max(min(1.-A.z/G,1.),.05)+.05-fract(sin(dot(A.xy.xy,vec2(12.9898,78.233)))*43758.5453123)*.1;P*=P;if(Z.y>10.1)P=1.;fragColor=mix(vec4(.2,.094,.196,1.0),E,P);fragColor.w*=O;}\n",L.FRAGMENT_SHADER,M);L.linkProgram(M);L.useProgram(M);pb=L.getUniformLocation(M,"uMeshMatrix");nb=L.getUniformLocation(M,"uCameraMatrix");qb=L.getUniformLocation(M,"uProjectionMatrix");
const a=(new Float32Array(60)).fill(0).map((b,c)=>1==c%3?0:40-80*Math.random());L.uniform3fv(L.getUniformLocation(M,"uLightPosition"),a);mb=L.getUniformLocation(M,"G");L.uniform1f(mb,15);uOpacityLocation=L.getUniformLocation(M,"O");L.uniform1f(uOpacityLocation,1);L.uniformMatrix4fv(qb,!1,perspective(n.C,n.o,n.F,n.B));M.A=L.getAttribLocation(M,"B");L.enableVertexAttribArray(M.A);M.v=L.getAttribLocation(M,"C");L.enableVertexAttribArray(M.v);M.u=L.getAttribLocation(M,"D");L.enableVertexAttribArray(M.u)};
compileShader=(a,b,c)=>{b=L.createShader(b);L.shaderSource(b,a);L.compileShader(b);L.getShaderParameter(b,L.COMPILE_STATUS)?L.attachShader(c,b):console.error("Shader compilation error:",L.getShaderInfoLog(b))};initialiseGameOverScene=()=>{messages=[];showMessage("\ud835\udd72\ud835\udd8d\ud835\udd94\ud835\udd98\ud835\udd99 \ud835\udd86\ud835\udd8c\ud835\udd86\ud835\udd8e\ud835\udd93",N,O-15,30);showMessage("Press enter to reincarnate!",N,O+25,15)};
updateGameOverScene=()=>{console.log(messages);A.clearRect(0,0,R,S);updateMessages();sb&&window.location.reload()};
const tb=()=>{messages=[];showMessage("\ud835\udd6f\ud835\udd8e\ud835\udd92\ud835\udd8a\ud835\udd93\ud835\udd98\ud835\udd8e\ud835\udd94\ud835\udd93",N,.5*O,.4*O,1E7,30);showMessage("\ud835\udd7f\ud835\udd8d\ud835\udd8e\ud835\udd97\ud835\udd99\ud835\udd8a\ud835\udd8a\ud835\udd93",N,.85*O,.4*O,1E7,35);showMessage("Escape the thirteenth dimension",N,1.2*O,.2*O,1E7,60)},wb=()=>{A.clearRect(0,0,1E6,1E6);updateMessages();(sb||ub||vb)&&showScene(playScene(),!0)};document.onclick=()=>{document.documentElement.requestPointerLock()};
var xb,yb,zb=0,T=0,Ab=.2,X=1,w,Ua=[],x=1,Bb=.99,Cb=[],r=0,Y,Db,ub,vb,Eb,Fb,Gb=z([]),u=[],Hb=[],Ib=0,ab,m,Jb=[];
const Nb=()=>{Kb("\n    Hey, Comrade.\n\nYour teleporter's dead, and you're now stranded in the 13th dimension thanks to the Poland Space Program. To escape, find seven power gems.\n\nAlso, that timer? If it hits 13, run back to the teleporter or face an epic ending.\n\nGood luck, which you don't need because you will die anyway!",1.2);messages=[];Fb=z([]);for(var a=0;10>a;a++)Fb.g.push(g(Ca,Da,Ea,l(0,0,0),l(0,a/10*Math.PI*2,0),l(4.5,4.5,4.5)));m=[g(na,oa,pa,w,w,l(1E3,1E3,1E3)),g(qa,ra,sa,l(0,.1,
0),l(0,Math.PI/4,0),l(4.5,1,4.5),1,1),z([g(za,Aa,Ba,l(0,90,0),w,l(30,30,30))])];n={position:l(0,1.69,0),direction:l(0,0,1),H:1.4,i:0,pitch:0,target:l(0,0,0),C:Math.PI/2,o:R/S,F:.1,B:200,O:l(0,1,0)};setInterval(()=>{if(4.358<distanceTo(l(w,w,w),n.position)){if(12<=T){Ib=.5;u.push(Ta());for(let b=0;b<T*T/10;b++){let c=100-200*Math.random(),e=100-200*Math.random();f(c,e)&&1<distanceTo(l(w,w,w),l(c,0,e))&&10<distanceTo(n.position,l(c,0,e))&&Ua.push(Va(l(c,0,e)))}zzfx(...[2.1,0,1E6,,.5,0,3,2.6,,,,,,,,
.5])}zzfx(...[2,.8,100,,,,,1.5,,.3,-99,.1,1.63,,,.11,.22]);zb=1;T++;13==T&&Kb("Run back")}},950);setInterval(()=>{zzfx(...[.4,.1,10,,.07,.26,,5,,,-100,.01,,,,,.25,.73,,,-1473]);Ab=.8;x+=.05},1200);rb();document.addEventListener("click",Lb);document.addEventListener("mousemove",Mb);Za();for(a=0;100>a;a++){let b=100-200*Math.random(),c=100-200*Math.random();f(b,c)&&10<distanceTo(l(w,w,w),l(b,0,c))&&Hb.push(Wa(l(b,0,c)))}for(a=0;7>a;a++)Cb.push(Qa());for(a=0;1E3>a;a++)Gb.g.push(g(ta,ua,va,l(rand(150),
30,rand(150)),w,l(.5,.5,.5)));m.push(Gb);m.push(Fb);ab=z([]);m.push(ab)},Qb=a=>{lb=2*Math.sin(timeStamp/200)+10+.4*Math.random()-.8;xb++;Ab*=Ab;Ib-=a/10;m[2].rotation.x+=a/40;Fb.rotation.y+=a/40;Ua.forEach(b=>b(a));Cb.forEach(b=>b(a));u.forEach(b=>b(a));Jb.forEach(b=>b(a));Hb.forEach(b=>b(a));A.globalAlpha=.8;A.drawImage(Ob,0,0);A.globalAlpha=1;A.fillStyle="white";A.font=`${15*(1+zb)}px monospace`;zb-=a;zb*=zb;A.fillText(T,10,20);A.fillRect(N-.5,O-3.5,.5,7);A.fillRect(N-3.5,O-.5,7,.5);A.fillStyle=
"#E37E90";A.fillRect(R/4-10,10,N*Math.max(Math.min(1,x),0),5);A.font=`${15*(1+Ab)}px sans-serif`;A.fillText("\u2764\ufe0f",R/4-10,15);A.fillStyle="#E8C165";A.fillRect(R/4-10,25,N*Math.max(Math.min(1,X),0),5);A.font="15px sans-serif";A.fillText("\u26a1",R/4-10,30);A.strokeStyle="#BFDDE722";A.lineWidth=(N>>1)*Bb;A.beginPath();A.arc(N,1.5*S,N,0,Bb*Math.PI+Math.PI);A.stroke();A.fillStyle="#FF000022";0<Ib&&A.fillRect(0,0,R,S);A.fillStyle="#80D08C";A.fillText("\u2b21\u2b21\u2b21\u2b21\u2b21\u2b21\u2b21".replace(/\u2b21/g,
(b,c)=>c<r?"\u2b22":b),R-40,10);Bb*=Math.pow(Bb,60*a);1<x&&(x=1);4.358>distanceTo(l(w,w,w),n.position)&&(T=0);6<r&&showScene(winScene(),!0);Gb.rotation.y+=a/100;updateMessages();0>x&&showScene(gameOverScene(),!0);bb();Eb=ub;Pb(a);ob(m,n)},Pb=a=>{let b=l(0,0,0);Rb?b=l(0,0,1+(Sb&&0<X)):Tb?b=l(0,0,-2/3):Ub?b=l(2/3,0,0):Vb?b=l(-2/3,0,0):vb||Y&&!(.1>Math.abs(Y[1]))||(X=Math.min(X+a/50,1));Y&&(n.i+=1*Y[0]*a,b.z=-Y[1]*(1+vb));Db&&(n.i+=Db[0]/2*a,n.pitch-=Db[1]/2*a);0==Eb&&1==ub&&Lb();if(vb||Sb)X-=a/100;
yb=B(n.position,multiplyBy(rotY(b,n.i),n.H*a));f(yb.x,yb.z)&&(n.position=yb);n.direction=B(rotY(l(0,0,1),n.i),l(0,n.pitch,0));n.target=B(n.position,n.direction)},Mb=a=>{n.i+=a.movementX/500;n.pitch-=a.movementY/500},Lb=()=>{if(!(0>X)){document.documentElement.requestPointerLock();var a=n;let c=substract(a.position,a.target);for(index in G){var b=normalize(substract(a.position,G[index]));b=substract(c,b);b=abs(b.x)+abs(b.y)+abs(b.z);if(5>distanceTo(a.position,G[index])&&3>b&&cb[index]){J[index]-=.5;
zzfx(...[1,,240,.02,.05,.08,4,3.1,,,,,.07,.2,9.4,.5,.03,.97,,.2]);if(0>=J[index])for(a=0;100>a;a++)Ra(Sa(G[index]),l(rand(.05),rand(.05),rand(.05)),"#FF0000",w,.2,!0);K=1;break}}zzfx(...[.8,,1E3,.11,.01,.21,4,.2,-.1,,,,,.4,.1,,,.59,,,19]);X-=.05;Bb=.99}};var Wb=!1,Z=0,Xb=null;showScene=(a,b)=>{Wb||(b?(Xb=a,Z=0,Wb=!0):Yb=a)};updateTransition=()=>{Z+=1;A.fillStyle=`rgba(0,0,0,${Math.max(50>=Z?2*Z/100:1-Z/100,0)})`;A.fillRect(0,0,R,S);50==Z&&(Yb=Xb,Yb.j());100<Z&&(Wb=!1)};menuScene=()=>({j:tb,update:wb});
playScene=()=>({j:Nb,update:Qb});gameOverScene=()=>({j:initialiseGameOverScene,update:updateGameOverScene});winScene=()=>({j:Zb,update:$b});var Zb=()=>{messages=[];showMessage("\ud835\udd08\ud835\udd33\ud835\udd1e\ud835\udd21\ud835\udd22\ud835\udd21",N,O-15,30);showMessage("GG, you win.",N,O+25,15)},$b=()=>{console.log(messages);A.clearRect(0,0,R,S);updateMessages();sb&&showScene(playScene(),!0)};console.log("%cIntellectual property of @retro-pigeon","font-size: 20px; color: red;");
var Ob=document.getElementById("glCanvas"),L=Ob.getContext("webgl2"),ac=document.getElementById("hudCanvas"),A=ac.getContext("2d");const Kb=(a,b=1.5)=>{a=new SpeechSynthesisUtterance(a);a.rate=b;window.speechSynthesis.speak(a)};var R,S,N,O;function bc(){R=window.innerWidth/4;S=window.innerHeight/4;N=.5*R;O=.5*S;ac.width=R;ac.height=S;Ob.width=R;Ob.height=S;void 0!==n&&void 0!==qb&&(n.o=R/S,L.uniformMatrix4fv(qb,!1,perspective(n.C,n.o,n.F,n.B)))}bc();onresize=bc;var pb,nb,qb,n,M,Yb=menuScene();Yb.j();
var F,cc=0;const dc=a=>{F=.01*(a-cc);cc=a;window.timeStamp=a;Yb.update(F);Wb&&updateTransition(F);a=navigator.getGamepads();for(let e=0;e<a.length;e++){const d=a[e];d&&(Y=d.axes.slice(0,2),Db=d.axes.slice(2,4),ub=d.buttons[4].pressed,vb=d.buttons[5].pressed)}let b=A.getImageData(0,0,R,S),c=Math.random()<F/10;b=new ImageData(new Uint8ClampedArray(b.data.map((e,d)=>d%4?b.data[(d+(c?-8:4))%(R*S*4)]:e)),R,S);A.putImageData(b,0,0);requestAnimationFrame(dc)};requestAnimationFrame(dc);
var Ub,Vb,Rb,Tb,sb,Sb;const ec=(a,b)=>{switch(a){case 65:Ub=b;break;case 16:Sb=b;break;case 87:Rb=b;break;case 68:Vb=b;break;case 13:sb=b;break;case 83:Tb=b}};onkeydown=a=>ec(a.keyCode,!0);onkeyup=a=>ec(a.keyCode,!1);
